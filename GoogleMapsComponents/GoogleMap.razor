@using Maps

@inherits MapComponent

<div @ref="@Element" id="@Id" class="@CssClass" style="@StyleStr"></div>

@code {
    /// <summary>
    /// Gets or sets the HTML element ID for the map container.
    /// </summary>
    [Parameter]
    public string? Id { get; set; }

    /// <summary>
    /// Gets or sets the Google Maps API key required for authentication.
    /// </summary>
    [Parameter]
    public string ApiKey { get; set; } = string.Empty;

    /// <summary>
    /// Gets or sets the configuration options for the Google Map.
    /// </summary>
    [Parameter]
    public MapOptions? Options { get; set; }

    /// <summary>
    /// Gets or sets the callback that is invoked after the map has been initialized.
    /// </summary>
    [Parameter]
    public EventCallback OnAfterInit { get; set; }

    /// <summary>
    /// Gets or sets the CSS class(es) to apply to the map container element.
    /// </summary>
    [Parameter]
    public string? CssClass { get; set; }

    private string _height = "500px";

    /// <summary>
    /// Default height 500px
    /// Used as style atribute "height: {Height}"
    /// </summary>
    [Parameter]
    public string Height
    {
        get => _height;
        set => _height = value ?? "500px";
    }

    private string StyleStr => $"height: {Height};";

    private ElementReference Element { get; set; }

    /// <summary>
    /// Initializes the map after the first render and invokes the OnAfterInit callback.
    /// </summary>
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await InitAsync(Element, Options);
            await OnAfterInit.InvokeAsync();
        }
        
        await base.OnAfterRenderAsync(firstRender);
    }

    /// <summary>
    /// Prevents re-rendering of the component after initialization to avoid interference with JavaScript map state.
    /// </summary>
    protected override bool ShouldRender() => false;
}